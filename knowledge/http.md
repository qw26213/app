### 从输入url到加载完页面都经历哪些过程

从输入URL到加载完页面，通常经历以下过程：

1. 解析URL：浏览器首先解析输入的URL，提取出协议类型（如http、https）、域名、端口号和路径等信息。

2. DNS解析：浏览器将解析得到的域名发送给DNS服务器，请求获取对应的IP地址。DNS解析会依次查询本地缓存、操作系统缓存和递归查询来获取IP地址。

3. 建立TCP连接：根据解析得到的IP地址和端口号，浏览器与服务器之间建立TCP连接。这个过程包括三次握手，即客户端向服务器发送连接请求，服务器接收请求并回复确认，最后客户端再次回复确认，建立起可靠的连接。

4. 发送HTTP请求：建立TCP连接后，浏览器向服务器发送HTTP请求。请求包括请求方法（如GET、POST）、请求头部（如User-Agent、Cookie、Accept等）、请求体（如表单数据、JSON数据等）等。

5. 服务器处理请求：服务器接收到请求后，根据请求的URL和其他相关信息进行处理。这可能包括读取文件、查询数据库、执行服务器端代码等操作。

6. 服务器发送响应：服务器处理完请求后，将生成的响应内容发送回浏览器。响应包括响应状态码（如200表示成功、404表示未找到等）、响应头部（如Content-Type、Cache-Control等）和响应体（如HTML、CSS、JavaScript等）等。

7. 接收响应：浏览器接收到服务器发送的响应后，开始接收响应的数据。

8. 渲染页面：浏览器根据接收到的响应内容，开始对页面进行解析和渲染。它会解析HTML结构构建DOM树，加载和解析CSS样式构建CSSOM树，然后将DOM树和CSSOM树结合生成渲染树，最后将渲染树绘制在屏幕上。

9. 下载页面资源：在渲染过程中，浏览器可能会遇到需要下载其他资源（如图片、媒体文件、外部脚本等）。它会根据HTML中的标签和相关链接发起资源请求，并在接收到响应后下载和处理这些资源。

10. 执行JavaScript代码：当浏览器遇到需要执行的JavaScript代码时，会按顺序执行代码。JavaScript代码可以修改DOM树、处理用户交互和网络请求等操作。

11. 页面加载完成：当所有资源都被下载完毕，JavaScript代码也执行完毕时，页面加载完成。此时，用户可以进行交互和浏览页面了。

### 强制缓存和协商缓存

强制缓存就是在缓存到期之前无论什么情况，都会使用本地缓存数据来响应请求。常见的强制缓存策略有 Expires 和 Cache-Control 两种。其中，Expires 是 HTTP/1.0 的产物，它的值为一个过期时间，而该时间是一个绝对值，其格式类似这样：Expires: Thu, 24 Oct 2024 17:41:05 GMT。需要注意的是，它使用服务器返回的时间作为过期时间，所以如果客户端和服务器的时钟不一致，容易导致结果不一致。而 Cache-Control 是 HTTP/1.1 的产物，它的值是一个相对时间： Cache-Control: max-age=31536000，表示自请求发出后的31536000秒内是一个有效的缓存时间。

协商缓存则是总是向服务器发送请求，并根据服务器返回的响应头来判断是否使用本地缓存数据。常见的协商缓存策略有 ETag 和 Last-Modified 两种。其中，Etag 是服务器生成的一个版本号，它会放在响应头中，客户端发送请求时携带这个版本号，如果版本号匹配不上，则表明缓存失效，需要从服务器获取最新的数据。而 Last-Modified 则是服务器返回的响应头，表示资源的最后修改时间。当客户端再次请求同一资源时携带 If-Modified-Since 请求头，如果资源的最后修改时间早于这个请求头的值，则表示缓存有效，客户端可以直接使用本地缓存数据，否则则需要向服务器请求最新的数据。

需要注意的是，如果设定了Cache-Control的no-store或no-cache属性，那就不管是强制缓存还是协商缓存都不会起作用，每次请求都会向服务器请求最新数据。

两者都是通过设置响应头来实现。

### HTTP的请求头

1. Accept
2. Accept-Encoding
3. Accept-Language
4. Connection
5. Host (发送请求时，该报头域是必须)
6. Referer
7. Cache-Control
8. Cookie
9. Range（用于断点续传）
10. Content-Type
11. origin

### HTTP的状态码

200：服务器响应成功，也就是服务器找到了客户端请求的内容，并且将内容返回给客户端。
302：临时跳转。例如：URL地址A可以向URL地址B上跳转，但这并不是永久性的，在经过一段时间后，URL地址A还可能向URL地址C上跳转。
301：和302相似，不同的是301往往代表的是永久性的重定向，值得注意的是，这种重定向跳转，从严格意义来讲不是服务器跳转，而是客户端跳转的。这个“跳”的动作是服务器是通过回传301来下达给客户端的，让客户端完成跳转。
304：服务器通过返回304可以告诉客户端请求资源成功，但是这个资源不是由服务器提供返回给客户端的，而是客户端本地浏览器缓存中就有的这个资源，因为可以从缓存中获取这个资源，从而节省传输的开销。
403：没有权限去访问服务器的资源，或者请求的IP地址被封掉了。
404：服务器上没有该资源，或者说服务器找不到客户端请求的资源，是最常见的请求错误码。
500：程序错误，也就是说请求的网页程序本身报错了。在服务器端的网页程序出错。由于现在的浏览器都会对500做一定的处理，所以在一般情况下会返回一个定制的错误页面。

### 解决跨域的几种方式

1. jsonp跨域
2. iframe的postMessage
3. nginx反向代理
4. crs后端添加域名白名单
